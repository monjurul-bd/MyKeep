<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Keep PWA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <style>
        body { font-family: 'Google Sans', sans-serif; background-color: #F0F4F9; }
        .gemini-card { background: white; border-radius: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); transition: all 0.3s ease; }
        .gemini-input { background: #F0F4F9; border-radius: 16px; border: none; outline: none; transition: 0.3s; }
        .gemini-input:focus { background: #E2E7EB; box-shadow: 0 0 0 2px #A8C7FA; }
        .fab { position: fixed; bottom: 24px; right: 24px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        /* Hide scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
    </style>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#F0F4F9">
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">

    <header class="p-5 flex justify-between items-center bg-[#F0F4F9]">
        <div class="flex items-center gap-2">
            <span class="material-icons-outlined text-3xl text-blue-600">auto_awesome</span>
            <h1 class="text-2xl font-bold text-gray-700">AI Notes</h1>
        </div>
        <button onclick="requestNotificationPermission()" class="text-gray-500 hover:text-blue-600">
            <span class="material-icons-outlined">notifications_active</span>
        </button>
    </header>

    <main class="flex-1 overflow-y-auto p-4 pb-24" id="note-container">
        </main>

    <button onclick="openModal()" class="fab bg-[#C3E7FF] text-[#001D35] p-4 flex items-center justify-center hover:bg-[#A8C7FA] transition">
        <span class="material-icons-outlined text-3xl">add</span>
    </button>

    <div id="noteModal" class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center z-50 px-4">
        <div class="bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl transform transition-all scale-100">
            <h2 class="text-xl font-bold mb-4 text-gray-700">নতুন নোট</h2>
            
            <input type="text" id="noteTitle" placeholder="শিরোনাম (Title)" class="gemini-input w-full p-4 mb-3 text-lg font-medium">
            <textarea id="noteDesc" placeholder="আপনার নোট লিখুন..." rows="4" class="gemini-input w-full p-4 mb-3 resize-none"></textarea>
            
            <div class="flex items-center gap-2 mb-6 bg-gray-50 p-3 rounded-xl border border-gray-100">
                <span class="material-icons-outlined text-gray-500">alarm</span>
                <input type="datetime-local" id="noteTime" class="bg-transparent outline-none text-sm text-gray-600 w-full">
            </div>

            <div class="flex justify-end gap-3">
                <button onclick="closeModal()" class="px-5 py-2 text-gray-600 font-medium hover:bg-gray-100 rounded-full transition">বাতিল</button>
                <button onclick="saveNote()" class="px-6 py-2 bg-[#0B57D0] text-white font-medium rounded-full shadow-lg hover:shadow-xl transition">সেভ করুন</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. State Management ---
        let notes = JSON.parse(localStorage.getItem('gemini_notes')) || [];
        
        // --- 2. Initial Render ---
        document.addEventListener('DOMContentLoaded', () => {
            renderNotes();
            checkReminders();
            // Request Notification Permission on load
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        });

        // --- 3. Functions ---
        
        function openModal() {
            document.getElementById('noteModal').classList.remove('hidden');
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteDesc').value = '';
            document.getElementById('noteTime').value = '';
        }

        function closeModal() {
            document.getElementById('noteModal').classList.add('hidden');
        }

        function saveNote() {
            const title = document.getElementById('noteTitle').value;
            const desc = document.getElementById('noteDesc').value;
            const time = document.getElementById('noteTime').value;

            if (!title && !desc) {
                alert("নোট খালি রাখা যাবে না!");
                return;
            }

            const newNote = {
                id: Date.now(),
                title: title || 'Untitled',
                desc: desc,
                time: time,
                notified: false
            };

            notes.unshift(newNote); // Add to top
            updateStorage();
            renderNotes();
            closeModal();
        }

        function deleteNote(id) {
            if(confirm("আপনি কি এই নোটটি ডিলিট করতে চান?")) {
                notes = notes.filter(note => note.id !== id);
                updateStorage();
                renderNotes();
            }
        }

        function updateStorage() {
            localStorage.setItem('gemini_notes', JSON.stringify(notes));
        }

        function renderNotes() {
            const container = document.getElementById('note-container');
            container.innerHTML = '';

            if (notes.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-gray-400 mt-20">
                        <span class="material-icons-outlined text-6xl mb-4">lightbulb</span>
                        <p>আপনার প্রথম নোট যোগ করুন</p>
                    </div>`;
                return;
            }

            notes.forEach(note => {
                const dateDisplay = note.time ? new Date(note.time).toLocaleString('bn-BD') : '';
                const timeBadge = note.time ? 
                    `<div class="inline-flex items-center gap-1 text-xs bg-blue-50 text-blue-700 px-2 py-1 rounded-full mt-2">
                        <span class="material-icons-outlined text-[14px]">alarm</span> ${dateDisplay}
                     </div>` : '';

                const html = `
                    <div class="gemini-card p-5 mb-4 border border-gray-100 relative group">
                        <h3 class="font-bold text-lg text-gray-800 mb-1">${note.title}</h3>
                        <p class="text-gray-600 whitespace-pre-wrap text-sm leading-relaxed">${note.desc}</p>
                        ${timeBadge}
                        <button onclick="deleteNote(${note.id})" class="absolute top-4 right-4 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                            <span class="material-icons-outlined">delete</span>
                        </button>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- 4. Reminder Logic (Checks every 30 seconds) ---
        function checkReminders() {
            setInterval(() => {
                const now = new Date().getTime();
                let updated = false;

                notes.forEach(note => {
                    if (note.time && !note.notified) {
                        const reminderTime = new Date(note.time).getTime();
                        
                        // If time is passed (within last 1 minute window)
                        if (reminderTime <= now && reminderTime > now - 60000) {
                            sendNotification(note.title, note.desc);
                            note.notified = true; // Mark as notified
                            updated = true;
                        }
                    }
                });

                if (updated) updateStorage();

            }, 30000); // Check every 30s
        }

        function sendNotification(title, body) {
            // Play a sound (Optional)
            // const audio = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');
            // audio.play();

            if (Notification.permission === "granted") {
                new Notification("Reminder: " + title, {
                    body: body,
                    icon: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8a/Google_Gemini_logo.svg/1200px-Google_Gemini_logo.svg.png"
                });
            } else {
                alert(`Reminder: ${title}\n${body}`);
            }
        }

        function requestNotificationPermission() {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    alert("নোটিফিকেশন চালু হয়েছে!");
                }
            });
        }

        // --- 5. PWA Service Worker Registration (Stub) ---
        if ('serviceWorker' in navigator) {
            // In a real usage, you would register a sw.js file here
            // navigator.serviceWorker.register('sw.js');
        }
    </script>
</body>
</html>
